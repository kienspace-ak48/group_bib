<div class="page-header">
    <div class="page-block">
        <div class="row align-items-center">
            <div class="col-md-12">
                <div class="page-header-title">
                    <h5 class="m-b-10">Event</h5>
                </div>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#!">Post</a></li>
                    <li class="breadcrumb-item"><a href="#!">create new post</a></li>
                    <!-- <li class="breadcrumb-item" aria-current="page">Home</li> -->
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- breack-crum -->

<div class="card">
    <div class="card-header d-flex justify-content-between align-item-center">
        <h2>Event List</h2>
        <a class="btn btn-primary" href="/admin/event/form">New event</a>
    </div>
    <div class="card-body">
        <table id="eventTbl" class="table .table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Place</th>
                    <th>Start date</th>
                    <th>End date</th>
                    <th>Status</th>
                    <th>Show</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <% if (events && events.length > 0) { %> <% events.forEach((e, index) => { %>
                <tr data-id="<%=e._id%>">
                    <td data-id="<%= e._id %>">
                        <a href="/admin/event/form-edit/<%=e.slug%>"><%= e.name %></a>
                    </td>
                    <td><%= e.location %></td>
                    <td><%= new Date(e.start_date).toLocaleDateString('vi-VN') %></td>
                    <td><%= new Date(e.end_date).toLocaleDateString('vi-VN') %></td>
                    <td><%= e.status %></td>
                    <td><%= e.isShow %></td>
                    <td>
                        <button class="btn btn-danger btn-cta-del-event" data-id="<%=e._id%>">Delete</button>
                    </td>
                </tr>
                <% }) %> <% } else { %>
                <tr>
                    <td colspan="7" class="text-center">Không có sự kiện nào</td>
                </tr>
                <% } %>
            </tbody>
        </table>
    </div>
</div>
<!-- ==========script here======= -->
<script>
    // ==global
    const eventBodyTbl = document.querySelector('#eventTbl tbody'); 
    // ==

    function deleteEvent(id){
        $.ajax({
            url: `/admin/event/${id}`,
            method: "DELETE",
            contentType: 'application/json',
            success: (res)=>{
                if(res.success){
                    myNotification('delete success', 'success', timer=1000);
                    const row = eventBodyTbl.querySelector(`tr[data-id="${id}"]`);
                    if(row) row.remove();
                }
            },
            error: (xhr, status, err)=>{
                console.log(xhr.responseJSON.mess);
                myNotification('Server error', 'error');
            }
        })
    }

        eventBodyTbl.addEventListener('click', (e)=>{
            // const id = el.getAttribute('data-id');
            const btn = e.target.closest('.btn-cta-del-event');
            if(!btn) return;
            const tr = btn.closest('tr');
            if(!tr) return;
            const id_tr = tr.getAttribute('data-id');
            // const id = btn.getAttribute('data-id');
            // console.log('id tr: ',id_tr);
            Swal.fire({
                title: 'Are you sure?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes'
            }).then((result)=>{
                if(result.isConfirmed){
                    deleteEvent(id_tr);
                }
            })
        })
    //my notification
    function myNotification(title, icon,timer=2500 ,position='center' ){
        Swal.fire({
            title: title,
            icon: icon,
            position: position,
            timer: timer
        })
    }  
    // myNotification('hi', 'success');
</script>