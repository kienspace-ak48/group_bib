<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js" integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y" crossorigin="anonymous"></script>
<style>
    * {
        font-family: 'Inter', sans-serif;
    }
    .header-gradient {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .badge-warning {
        background-color: #fef3c7;
        color: #92400e;
    }
    .badge-success {
        background-color: #d1fae5;
        color: #065f46;
    }
</style>
<body class="bg-gray-50">
    <div class="">
        <!-- Main Content -->
        <main class="m-auto mx-auto px-4 py-2">
            <div class="flex flex-col justify-center gap-3">
                <!-- Left column: Event info -->
                <!-- <div class="lg:w-1/3">
                    <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Sự kiện</h2>
                        
                        <div class="space-y-6">
                            <div>
                                <div class="flex items-center mb-2">
                                    <div class="bg-indigo-100 p-2 rounded-lg mr-3">
                                        <i class="fas fa-flag-checkered text-indigo-600"></i>
                                    </div>
                                    <h3 class="text-lg font-semibold text-gray-700">Test Send Email</h3>
                                </div>
                                <p class="text-gray-600 ml-11">Sự kiện gửi email thử nghiệm</p>
                            </div>
                            
                            <div>
                                <div class="flex items-center mb-2">
                                    <div class="bg-blue-100 p-2 rounded-lg mr-3">
                                        <i class="fas fa-calendar-day text-blue-600"></i>
                                    </div>
                                    <h3 class="text-lg font-semibold text-gray-700">Thời gian</h3>
                                </div>
                                <p class="text-gray-600 ml-11">09/01/2026</p>
                            </div>
                            
                        </div>
                    </div>
                    
                </div> -->

                <!-- Right column: Athlete details -->
                <div class="lg:w-2/3">
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <!-- Header with status -->
                        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-6">
                            <div class="flex flex-row md:flex-row justify-between items-start md:items-center">
                                <div>
                                    <h2 class="text-2xl font-bold text-white mb-2">Thông tin chi tiết</h2>
                                    <%if(pc.checkin_status){%>
                                        <div class="inline-flex items-center px-3 py-1 rounded-full mt-4 badge-success">
                                        <i class="fas fa-circle-check mr-2"></i>
                                        <span class="font-medium text-[12px] mt-">Đã checkin : <%=pc.checkin_status%></span>
                                    </div>
                                    <%}else{%>
                                        <div class="inline-flex items-center px-3 py-1 rounded-full mt-4 badge-warning">
                                        <i class="fas fa-exclamation-triangle mr-2"></i>
                                        <span class="font-medium text-[12px] mt-">Chưa checkin : <%=pc.checkin_status%></span>
                                    </div>
                                    <%}%>
    
                                </div>

                                <div class="mt-4 md:mt-0">
                                    <div class="bg-white/20 backdrop-blur-sm p-3 rounded-lg">
                                        <p class="text-white text-sm">Category:<%=pc.distance%></p>
                                        <p class="text-white text-2xl font-bold">
                                            CODE: <span class="text-amber-300"><%=pc.bib%></span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Athlete details -->
                        <div class="p-6">
                            <div class="grid grid-cols-2 gap-6">
                                <!-- Personal Info -->
                                <div class="space-y-6">
                                    <h3 class="text-lg font-bold text-gray-800 border-b pb-2">Thông tin cá nhân</h3>
                                    <input id="code_hidden" type="hidden" value="<%=pc.uid%>">
                                    <div class="space-y-4">
                                        <div>
                                            <p class="text-sm text-gray-500">Họ tên </p>
                                            <span class="text-lg font-semibold text-gray-800"><%=pc.fullname%></span>
                                            
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">Giới tính</p>
                                            <span class="font-medium text-gray-800"><%=pc.gender?'Nam':'Nữ'%></span>
                                            
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-500">Size áo/Vật phẩm</p>
                                            <p class="font-medium text-gray-800"><%=pc.tshirt_size%></p>
                                        </div>

                                            
                                       

                                        <div>
                                            <p class="text-sm text-gray-500">Nickname</p>
                                            <div
                                                class="inline-flex items-center px-3 py-1 bg-blue-100 text-blue-800 rounded-full font-medium"
                                            >
                                                <i class="fas fa-id-badge mr-2"></i>
                                                <%=pc.bib_name%>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Contact Info -->
                                <div class="space-y-6">
                                    <h3 class="text-lg font-bold text-gray-800 border-b pb-2">Thông tin liên hệ</h3>

                                    <div class="space-y-4">
                                        <div>
                                            <p class="text-sm text-gray-500">CCCD/Passport</p>
                                            <p class="font-mono text-lg font-semibold text-gray-800"><%=pc.cccd%></p>
                                        </div>

                                        <div>
                                            <p class="text-sm text-gray-500">Ngày sinh</p>
                                            <div class="flex items-center">
                                                <i class="fas fa-birthday-cake text-purple-500 mr-2"></i>
                                                <p class="font-medium text-gray-800"><%=pc.dob%></p>
                                            </div>
                                        </div>

                                        <div>
                                            <p class="text-sm text-gray-500">Số điện thoại</p>
                                            <div class="flex items-center">
                                                <i class="fas fa-phone text-green-500 mr-2"></i>
                                                <p class="font-medium text-gray-800"><%=pc.phone%></p>
                                            </div>
                                        </div>

                                        <div>
                                            <p class="text-sm text-gray-500">Email</p>
                                            <div class="flex items-center">
                                                <i class="fas fa-envelope text-red-500 mr-2"></i>
                                                <p class="font-medium text-gray-800 truncate"><%=pc.email%></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            

                            <!-- Additional notes -->
                            <!-- <div class="mt-8 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-exclamation-circle text-amber-500 text-xl"></i>
                                    </div>
                                    <div class="ml-3">
                                        <h3 class="text-sm font-medium text-amber-800">Lưu ý quan trọng</h3>
                                        <div class="mt-2 text-sm text-amber-700">
                                            <p>Vận động viên chưa ký miễn trừ trách nhiệm. Vui lòng hoàn tất thủ tục này trước khi cho phép tham gia sự kiện.</p>
                                        </div>
                                    </div>
                                </div>
                            </div> -->
                        </div>
                    </div>

                    
                    
                </div>
                <!-- Chup hinh va ky -->
                <div class="">
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <div class="p-6">
                            <div class="grid grid-cols-2 gap-6">
                                <div>
                                    <button class="btn btn-outline-success" id="openCamera">Mở camera</button>

                                <div id="cameraBox" style="display:none">
                                <video id="video" autoplay playsinline></video>
                                <br />
                                <button id="capture">Chụp</button>
                                </div>

                                <div id="previewBox" style="display:none">
                                <img id="preview" />
                                <br />
                                <button id="retake">Chụp lại</button>
                                <button id="upload">Upload</button>
                                </div>

                                <canvas id="canvas" hidden></canvas>

                            </div>
                            </div>
                            </div>
                                                                
                                                                <!-- Chu ky -->
                                                                
                     <!-- test -->
                    <script>
                                                    const openBtn = document.getElementById('openCamera');
                                const video = document.getElementById('video');

                                let stream;

                                openBtn.onclick = async () => {
                                stream = await navigator.mediaDevices.getUserMedia({
                                    video: { facingMode: 'environment' }, // camera sau
                                    audio: false
                                });

                                video.srcObject = stream;
                                document.getElementById('cameraBox').style.display = 'block';
                                };
                                // 
                                const captureBtn = document.getElementById('capture');
                                const canvas = document.getElementById('canvas');
                                const preview = document.getElementById('preview');

                                captureBtn.onclick = () => {
                                canvas.width = video.videoWidth;
                                canvas.height = video.videoHeight;

                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(video, 0, 0);

                                const imageData = canvas.toDataURL('image/jpeg');

                                preview.src = imageData;

                                document.getElementById('cameraBox').style.display = 'none';
                                document.getElementById('previewBox').style.display = 'block';
                                };
                                // 
                                document.getElementById('retake').onclick = () => {
                                document.getElementById('previewBox').style.display = 'none';
                                document.getElementById('cameraBox').style.display = 'block';
                                };
                                // 
                                // =================CHU ky

                 </script>
                </div>
                <!-- GROUP ACTION -->
                 <!-- group acction -->
                <div>
                    <!-- Quick actions footer -->
                     <%if(pc.checkin_status){%>
                        <div class="mt-6 flex gap-4 justify-center items-center ">
                            <a href="/tool-checkin" class=" justify-center-safe inline-block">
                                <button class=" bg-purple-600 text-white font-medium py-3 px-4 rounded-lg hover:bg-purple-700 transition flex items-center justify-center">
                            <i class="fas fa-edit mr-3"></i>
                            Trở về
                        </button>
                            </a>
                        </div>
                        
                     <%}else{%>
                        <div class="mt-6 flex flex-row gap-4">
                       
                            <a href="/tool-checkin" class=" justify-center-safe inline-block flex-1">
                                <button class=" bg-purple-600 text-white font-medium py-3 px-4 rounded-lg hover:bg-purple-700 transition flex items-center justify-center">
                            <i class="fas fa-edit mr-3"></i>
                            Trở về
                        </button>
                            </a>
                        
                        <button id="btn_cta_checkin"
                            class="flex-1 bg-green-600 text-white font-medium py-3 px-4 rounded-lg hover:bg-green-700 transition flex items-center justify-center"
                        >
                            <i class="fas fa-check-circle mr-3"></i>
                            Xác nhận Checkin
                        </button>
                    </div>
                     <%}%>
                </div>
            </div>
        </main>
    </div>

<!--  -->
<script>
        // Xử lý sự kiện click cho các nút chính
        document.querySelector('#btn_cta_checkin').addEventListener('click', (ev)=>{
            const payload = {
                code: document.querySelector('#code_hidden').value.trim()
            }
            // alert(payload)
            $.ajax({
                url: `/tool-checkin/check-in`,
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(payload),
                success: (res)=>{
                    console.log(res)
                    if(res.success){
                        document.location.reload();
                    }
                },
                error: (xhr, status, err)=>console.log(xhr.responseJSON?.mess||'Server error')
            })
        })
    </script>
</body>
