<div class="main-container">
    <div class="mx-auto p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- ==== Left Column (TH√îNG TIN NG∆Ø·ªúI ƒêƒÇNG K√ù) ==== -->
        <div class="lg:col-span-2 space-y-4 lg:min-h-screen" id="register_list">
            <h2 class="text-lg font-bold text-gray-700 flex items-center gap-2">üèÉ TH√îNG TIN NG∆Ø·ªúI ƒêƒÇNG K√ù</h2>
            <%let no = 1;%> <% carts.forEach(t => { %> <% for(let i = 0; i < t.qty; i++){ %>
            <!-- Render form nh·∫≠p th√¥ng tin -->
            <!-- Item 2 -->
            <div class="bg-white rounded-lg shadow p-4" data-item data-type="runner">
                <div class="flex items-center justify-between cursor-pointer" data-header>
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 bg-indigo-500 text-white rounded-full flex items-center justify-center font-semibold"
                        >
                            <%=no++%>
                        </div>
                        <span class="font-semibold text-gray-800"><%=t.name%></span>
                        <input type="hidden" name="distance_type" value="<%=t.id%>" />
                    </div>

                    <svg
                        class="w-6 h-6 text-gray-500 transition-transform"
                        data-icon-down
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>

                    <svg
                        class="w-6 h-6 text-gray-500 transition-transform hidden"
                        data-icon-up
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
                    </svg>
                </div>

                <div class="mt-4 border-t pt-4 space-y-3 text-gray-700 hidden" data-content>
                    <!-- left -->
                    <div class="bg-white p-4 rounded-lg shadow-lg border-gray-200 space-y-4">
                        <label for="" class="font-semibold mb-1 text-[20px] tracking-normal">Th√¥ng tin c√° nh√¢n</label>
                        <!-- Form Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm font-medium">H·ªç & t√™n (*)</label>
                                <input
                                    id="fullname"
                                    name="fullname"
                                    class="w-full border border-[#cacfe7] rounded-lg px-3 py-2 focus:border-[#9fbcf0] focus:outline-none"
                                />
                                <p id="err-fullname" class="text-xs text-pink-500 mt-1">
                                    Nh·∫≠p ƒë√∫ng theo CCCD ho·∫∑c Gi·∫•y khai sinh.
                                </p>
                            </div>

                            <div>
                                <label class="text-sm font-medium">Email (*)</label>
                                <input
                                    name="email"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] focus:outline-none"
                                />
                                <p id="err-email" class="text-xs text-pink-500 mt-1">N√™n d√πng Gmail ƒë·ªÉ ƒëƒÉng k√Ω.</p>
                            </div>

                            <div>
                                <label class="text-sm font-medium">S·ªë ƒëi·ªán tho·∫°i (*)</label>
                                <input
                                    name="phone"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] focus:outline-none"
                                />
                                <p id="err-phone" class="text-xs text-pink-500 mt-1">Nh·∫≠p sdt c·ªßa ng∆∞·ªùi ch·∫°y</p>
                            </div>

                            <div>
                                <label class="text-sm font-medium">CCCD ho·∫∑c h·ªô chi·∫øu (*)</label>
                                <input
                                    name="cccd"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] focus:outline-none"
                                />
                                <p id="err-cccd" class="text-xs text-pink-500 mt-1">
                                    N·∫øu ch∆∞a c√≥ CCCD, nh·∫≠p ƒë·ªãnh danh c·ªßa ng∆∞·ªùi gi√°m h·ªô.
                                </p>
                            </div>

                            <div>
                                <label class="text-sm font-medium">Qu·ªëc t·ªãch (*)</label>
                                <select
                                    name="nationlity"
                                    id="nationlity"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] focus:outline-none"
                                >
                                    <%if(countries&&countries.length> 0){%>
                                    <option value="VN">Vi·ªát Nam</option>
                                    <%countries.forEach(q=>{%>
                                    <option value="<%=q.code%>"><%=q.name%></option>
                                    <%})%> <%}%>
                                </select>
                            </div>

                            <div>
                                <label class="text-sm font-medium">Qu·ªëc gia ƒëang sinh s·ªëng (*)</label>
                                <select
                                    name="nation"
                                    id="nation"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus-border[#9fbcf0] focus:outline-none"
                                >
                                    <option value="VN">Vi·ªát Nam</option>
                                    <%if(countries&&countries.length> 0){%> <%countries.forEach(q=>{%>
                                    <option value="<%=q.code%>"><%=q.name%></option>
                                    <%})%> <%}%>
                                </select>
                            </div>

                            <div>
                                <label class="text-sm font-medium">T·ªânh/Th√†nh ph·ªë ƒëang sinh s·ªëng (*)</label>
                                <select
                                    name="city"
                                    id="city"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] outline-none"
                                >
                                    <option>H·ªì Ch√≠ Minh</option>
                                    <%if(provinces && provinces.length>0){%> <%provinces.forEach(p=>{%>
                                    <option value="<%=p.name%>"><%=p.name%></option>
                                    <%})%> <%}%>
                                </select>
                            </div>

                            <div>
                                <label class="text-sm font-medium">Ng√†y sinh (*)</label>
                                <input
                                    name="dob"
                                    type="date"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] focus:outline-none"
                                />
                                <p id="err-dob" class="text-xs text-pink-500 mt-1"></p>
                            </div>

                            <div>
                                <label class="text-sm font-medium">Gi·ªõi t√≠nh (*)</label>
                                <select
                                    name="gender"
                                    id="gender"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] focus:outline-none"
                                >
                                    <option value="">Ch·ªçn th√¥ng tin</option>
                                    <option value="0">N·ªØ</option>
                                    <option value="1">Nam</option>
                                </select>
                                <p id="err-gender" class="text-xs text-pink-500 mt-1"></p>
                            </div>
                        </div>

                        <!-- Th√¥ng tin kh√°c -->
                        <h3 class="text-lg font-semibold text-gray-800 mt-8 mb-3">Th√¥ng tin kh√°c</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm font-medium">T√™n tr√™n BIB</label>
                                <input
                                    name="bib_name"
                                    id="bib_name"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] focus: outline-none"
                                />
                                <p id="err-bib_name" class="text-xs text-pink-500 mt-1"></p>
                            </div>
                            <div>
                                <label class="text-sm font-medium">Distance</label>
                                <!-- <select name="distance" id="distance" class="w-full border rounded-lg px-3 py-2"> -->
                                <input
                                    type="text"
                                    class="w-full border rounded-lg px-3 py-2 text-[red]"
                                    value="<%=t.name%>"
                                    disabled
                                />
                                <a href="#" class="text-blue-600 text-sm mt-1 inline-block">Chi ti·∫øt c·ª° √°o</a>
                            </div>
                            <div>
                                <label class="text-sm font-medium">Size √°o (*)</label>
                                <select
                                    name="tshirt_size"
                                    id="tshirt_size"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] focus:outline-none"
                                >
                                    <option value="">Ch·ªçn th√¥ng tin</option>
                                    <option value="M">M</option>
                                    <option value="L">L</option>
                                    <option value="L">XL</option>
                                </select>
                                <a href="#" class="text-blue-600 text-sm mt-1 inline-block">Chi ti·∫øt c·ª° √°o</a>
                                <p id="err-tshirt_size" class="text-xs text-pink-500 mt-1"></p>
                            </div>

                            <!-- 3 input tr·ªëng -->
                            <div>
                                <label for="" class="text-sm font-medium">T√™n ng∆∞·ªùi li√™n h·ªá kh·∫©n c·∫•p</label>
                                <input
                                    name="patron_name"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] focus:outline-none"
                                    placeholder="Ex: Nguyen Van A"
                                />
                                <p id="err-patron_name" class="text-xs text-pink-500 mt-1"></p>
                            </div>
                            <div>
                                <label for="">SƒêT ng∆∞·ªùi li√™n h·ªá kh·∫©n c·∫•p</label>
                                <input
                                    name="patron_phone"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] focus:outline-none"
                                    placeholder="Ex: 19001900"
                                />
                                <p id="err-patron_phone" class="text-xs text-pink-500 mt-1"></p>
                            </div>
                            <div>
                                <label for="">Team</label>
                                <input
                                    name="team"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:outline-none focus:border-[#9fbcf0]"
                                    placeholder="Ex: Accessrace"
                                />
                                <p id="err-team" class="text-xs text-pink-500 mt-1"></p>
                            </div>
                        </div>

                        <!-- Th√¥ng tin y t·∫ø -->
                        <h3 class="text-lg font-semibold text-gray-800 mt-8 mb-3">Th√¥ng tin y t·∫ø</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="">Nh√≥m m√°u</label>
                                <p>--</p>
                                <!-- <input name="blood" class="w-full border rounded-lg px-3 py-2" placeholder="Nh√≥m m√°u" /> -->
                                <select
                                    name="blood"
                                    id="blood"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] focus:outline-none"
                                >
                                    <option value="">--choose--</option>
                                    <option value="O">O</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="AB">AB</option>
                                    <option value="NO">-Kh√¥ng r√µ-</option>
                                </select>
                                <p id="err-blood" class="text-xs text-pink-500 mt-1"></p>
                            </div>
                            <div>
                                <label for="">Th√¥ng tin y t·∫ø</label>
                                <p><small>(nh·∫≠p n·∫øu c√≥)</small></p>
                                <input
                                    name="medical"
                                    value="--Kh√¥ng--"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] focus:outline-none"
                                    placeholder="Th√¥ng tin y t·∫ø"
                                />
                                <p id="err-medical" class="text-xs text-pink-500 mt-1"></p>
                            </div>
                            <div>
                                <label for="">Lo·∫°i thu·ªëc ƒëang d√πng </label>
                                <p><small>(nh·∫≠p n·∫øu c√≥)</small></p>
                                <input
                                    name="medicine"
                                    value="--Kh√¥ng--"
                                    class="w-full border rounded-lg px-3 py-2 border-[#cacfe7] focus:border-[#9fbcf0] focus:outline-none"
                                    placeholder="Lo·∫°i thu·ªëc ƒëang d√πng"
                                />
                                <p id="err-medicine" class="text-xs text-pink-500 mt-1"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <% } %> <% }) %>
        </div>

        <!-- ==== Right Column (FORM NG∆Ø·ªúI MUA) ==== -->
        <div class="space-y-4" id="buyer_info">
            <h2 class="text-lg font-bold text-gray-700 flex items-center gap-2">üßæ TH√îNG TIN NG∆Ø·ªúI MUA</h2>

            <div class="bg-white rounded-lg shadow p-4 space-y-3" buyer-data data-type="runner">
                <input
                    type="text"
                    id="buyer_name"
                    name="buyer_name"
                    placeholder="H·ªç & t√™n (*)"
                    class="w-full border p-2 rounded border-[#cacfe7] focus:outline-none focus:border-[#9fbcf0]"
                />
                <p id="err-buyer_name" class="err text-xs text-pink-500 mt-1"></p>
                <input
                    type="email"
                    id="buyer_email"
                    name="buyer_email"
                    placeholder="Email (*)"
                    class="w-full border p-2 rounded border-[#cacfe7] focus: outline-none focus:border-[#9fbcf0]"
                />
                <p id="err-buyer_email" class="err text-xs text-pink-500 mt-1"></p>
                <input
                    type="text"
                    id="buyer_phone"
                    name="buyer_phone"
                    placeholder="S·ªë ƒëi·ªán tho·∫°i (*)"
                    class="w-full border p-2 rounded border-[#cacfe7] focus: outline-none focus:border-[#9fbcf0]"
                />
                <p id="err-buyer_phone" class="err text-xs text-pink-500 mt-1"></p>
            </div>

            <h2 class="text-lg font-bold text-gray-700">üí≥ CH·ªåN NH√ìM THAM GIA</h2>

            <div class="bg-white rounded-lg shadow p-4">
                <label class="flex items-center gap-2 cursor-pointer">
                    <!-- Ch·ªçn group tham gia -->
                    <!-- <input type="radio" name="pay" checked />
                    <span class="font-medium">Thanh to√°n qua m√£ QR</span>
                    <span class="text-xs bg-blue-600 text-white px-2 py-1 rounded">ƒê·ªÅ xu·∫•t</span> -->
                </label>
                <select
                    name=""
                    id="group_id"
                    class="w-full border rounded-lg border-[#cacfe7] focus:border-[#9fbcf0] focus:outline-none"
                >
                    <%if(groups && groups.length>0){%> <%groups.forEach(g=>{%>
                    <option value="<%=g.id%>"><%=g.name%></option>
                    <%})%> <%}%>
                </select>
            </div>
            <!-- ================ -->
            <div class="w-full max-w-md">
                <!-- Title -->
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="22"
                        height="22"
                        fill="currentColor"
                        class="text-gray-700"
                        viewBox="0 0 16 16"
                    >
                        <path
                            d="M0 1.5A.5.5 0 0 1 .5 1H2l.5 2H14a1 1 0 0 1 .96 1.27l-1.5 6A1 1 0 0 1 12.5 11H4a1 1 0 0 1-.98-.8L1.61 3H.5a.5.5 0 0 1-.5-.5z"
                        />
                    </svg>
                    V√â C·ª¶A B·∫†N
                </h2>

                <!-- Card -->
                <div class="bg-white p-6 rounded-xl shadow">
                    <% carts.forEach(t => { %> <% for(let i = 0; i < t.qty; i++){ %>
                    <div class="flex justify-between py-2 border-b border-dashed">
                        <span>1 x <%=t.name%></span>
                        <span class="font-medium"><%=t.price%>,000ƒë</span>
                    </div>
                    <% } %> <% }) %>
                    <!-- Total -->
                    <div class="flex justify-between mt-1 text-lg font-bold">
                        <span>T·ªïng thanh to√°n</span>
                        <span class="text-blue-700" id="final_payment">1,316,000ƒë</span>
                    </div>
                </div>

                <!-- Coupon -->
                <div class="mt-4 bg-white p-4 rounded-xl shadow flex gap-3">
                    <input
                        type="text"
                        placeholder="M√£ gi·∫£m gi√°"
                        class="flex-1 border border-gray-300 rounded-lg px-3 py-2 outline-none focus:border-pink-500"
                    />

                    <button class="bg-pink-500 text-white font-semibold px-5 rounded-lg">√ÅP D·ª§NG</button>
                </div>

                <!-- Pay button -->
                <button
                    id="btn_cta_checkout"
                    class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl text-lg font-semibold flex items-center justify-center gap-2"
                >
                    THANH TO√ÅN
                </button>
            </div>
        </div>
    </div>
</div>

<!-- =========================== JS DROPDOWN =========================== -->
<script>
            // global scope
            const elementModal = document.querySelector('#formAddModal');
            let shoppingCart = <%-JSON.stringify(carts)%>;
            const btnCtaCheckout = document.querySelector('#btn_cta_checkout');

            let total = 0;
            total = shoppingCart.reduce((pre, cur)=>pre+cur.qty*cur.price, 0)
            // document.querySelector('#temp_payment').innerText = total.toLocaleString('vi-VN')+'.000ƒë'
            document.querySelector('#final_payment').innerText = total.toLocaleString('vi-VN')+'.000ƒë'
            console.log(shoppingCart)
            document.querySelectorAll('#register_list [data-item]').forEach((item) => {
                const header = item.querySelector('[data-header]');
                const content = item.querySelector('[data-content]');
                const iconDown = item.querySelector('[data-icon-down]');
                const iconUp = item.querySelector('[data-icon-up]');

                header.addEventListener('click', () => {
                    content.classList.toggle('hidden');
                    iconDown.classList.toggle('hidden');
                    iconUp.classList.toggle('hidden');
                });
            });
            //
            btnCtaCheckout.addEventListener('click', () => {
                const items = document.querySelectorAll('#register_list [data-item]');
                // const items2 = document.querySelectorAll('#buyer_info [buyer-data]');
                const result = [];
                let hasError = false;
                // 
                items.forEach((item, index) => {
                    const type =item.dataset.type;
                    const inputs = item.querySelectorAll('input, select');
                    const info = {};

                    inputs.forEach(input => {
                    if (!input.name) return;
                    info[input.name] = input.value;
                    });
                    //fix
                    const schema = runnerSchema;

                    // üî¥ VALIDATE TO√ÄN B·ªò 1 RUNNER
                    const parsed = schema.safeParse(info);

                    if (!parsed.success) {
                    hasError = true;

                    // show l·ªói t·ª´ng field
                    parsed.error.errors.forEach(err => {
                        console.error(`‚ùå Runner #${index + 1} | Field: ${err.path[0]} | L·ªói: ${err.message}`);
                        const field = err.path[0];
                        const input = item.querySelector(`[name="${field}"]`);
                        const errEl = item.querySelector(`#err-${field}`);

                        if (input) input.classList.add('border-red-500');
                        if (errEl) errEl.textContent = err.message;
                    });
                    }

                    result.push(info);
                });

                // ‚ùå C√ì L·ªñI ‚Üí KH√îNG SUBMIT
                if (hasError) {
                    console.log('loi gi? ',hasError)
                    console.log('Form c√≥ l·ªói, kh√¥ng submit');
                    return;
                }
                
                // ‚úÖ H·ª¢P L·ªÜ ‚Üí SUBMIT
                submitForm(result);
                });

            //==============================Validate here
            const buyerSchema = Zod.object({
                buyer_name: Zod.string().min(3, 'T·ªëi thi·ªÉu 3 k√Ω t·ª±'),
                buyer_email: Zod.string().email('N√™n s·ª≠a d·ª•ng gmail'),
                buyer_phone: Zod.string().min(9, { message: "SƒêT t·ªëi thi·ªÉu 9 s·ªë" })
    .refine(val => /^\d+$/.test(val), {
      message: "SƒêT ch·ªâ ƒë∆∞·ª£c ch·ª©a s·ªë"
    }),
            });
            // zod 2
            // get all data 
            function getFormData(){
                const data ={};
                document.querySelectorAll('#buyer_info input').forEach(input=>{
                    data[input.name] = input.value.trim();
                });
                return data;
            }
            function resetErrors(){
                document.querySelectorAll('#buyer_info .err').forEach((el)=>{
                    el.textContent ="";
                });
            }
            function renderErrors(zodError){
                console.log('zod error ', zodError);
                const errors = zodError.flatten().fieldErrors;
                Object.keys(errors).forEach((field)=>{
                    const errEl = document.querySelector(`#err-${field}`);
                    if(errEl){
                        errEl.textContent = errors[field][0];
                    }
                })
            }
            
            const runnerSchema = Zod.object({
                fullname: Zod.string().min(5, "√çt nh·∫•t 5 k√Ω t·ª±").max(40, 'Kh√¥ng qu√° 40 k√Ω t·ª±'),
                email: Zod.string().email("Email kh√¥ng h·ª£p l·ªá"),
                phone: Zod.string().min(9, "S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá(10 digit)"),
                cccd: Zod.string().min(9, "CCCD kh√¥ng h·ª£p l·ªá(>= 9 digit)"),
                gender: Zod.string().min(1, 'Vui l√≤ng ch·ªçn gi·ªõi t√≠nh'),
                dob: Zod.string().refine(val=>!isNaN(Date.parse(val)), {
                    message: "Ng√†y sinh kh√¥ng h·ª£p l·ªá",
                }),
                bib_name: Zod.string().min(1, 'Nickname ·∫•n t∆∞·ª£ng, sao l·∫°i ƒë·ªÉ tr·ªëng üòé').max(30, 'D√†i qu√° ai nh·ªõ n·ªói, hic...'),
                tshirt_size: Zod.string().min(1, 'Vui l√≤ng ch·ªçn size'),
                patron_name: Zod.string().min(2, 'T·ªëi thi·ªÉu 2 k√Ω t·ª±').max(40, 'Kh√¥ng qu√° 40 k√Ω t·ª±'),
                patron_phone: Zod.string().min(9, "S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá(10 digit)").max(20, 'S·ªë ƒëi·ªán tho·∫°i ngo√†i h√†nh tinh sao'),
                blood: Zod.string().min(1, 'Vui l√≤ng ch·ªçn nh√≥m m√°u'),
                medical: Zod.string().max(100, 'Kh√¥ng qu√° 100 k√Ω t·ª±'),
                medicine: Zod.string().max(100, 'Kh√¥ng qu√° 100 k√Ω t·ª±')
            });
            // L·∫Øng nghe t·∫•t c·∫£ runner
        document.querySelectorAll('[data-item]').forEach((item, index) => {
          const inputs = item.querySelectorAll('input, select');

          inputs.forEach(input => {
            const fieldName = input.name;
            if (!fieldName) return;

            // Realtime validate khi g√µ
            input.addEventListener('input', () => validateField(item, fieldName, input.value));

            // Validate khi r·ªùi input
            input.addEventListener('blur', () => validateField(item, fieldName, input.value));
          });
        });
        // H√†m validateField
        function validateField(item, fieldName, value) {
          const fieldSchema = runnerSchema.shape[fieldName];
          if (!fieldSchema) return;

          try {
            fieldSchema.parse(value); // validate field
            // X√≥a l·ªói n·∫øu h·ª£p l·ªá
            const input = item.querySelector(`[name="${fieldName}"]`);
            input.classList.remove('border-red-500');
            const errEl = item.querySelector(`#err-${fieldName}`);
            if (errEl) errEl.textContent = '';
          } catch (err) {
            const input = item.querySelector(`[name="${fieldName}"]`);
            input.classList.add('border-red-500');
            const errEl = item.querySelector(`#err-${fieldName}`);
            if (errEl) errEl.textContent = err.errors[0].message;
          }
        }
        

            // submit form
            function submitForm(data){
                const buyer = {
                    buyer_name: document.getElementById('buyer_name').value, buyer_email: document.getElementById('buyer_email').value, buyer_phone: document.getElementById('buyer_phone').value,
                    group_id: document.getElementById('group_id').value,
                    cart: shoppingCart
                }
                resetErrors();
                const data_check = getFormData();
                const result = buyerSchema.safeParse(data_check);
                if(!result.success){
                    renderErrors(result.error);
                    return
                }
                console.log('data buyer pass')
                // data.push({})
                // const merged = [{...data[0], ...data[1]}] //spread
                $.ajax({
                    url: `/user/event-detail/<%=slug%>/payment`,
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({runner: data, buyer}),
                    success: (res)=>{
                        if(res.success){
                            console.log(res);
                            document.location.href="/event";
                        }
                    },
                    error: (xhr, status, err)=>{
                        console.log(xhr.responseJSON.mess|| 'Server error');
                    }
                })
            }
</script>
