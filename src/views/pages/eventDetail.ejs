<style>
    hr {
        margin: 1rem 0;
        color: rgba(164, 174, 198, 0.2);
        border: 0;
        opacity: 1;
        clear: both;
        height: 1px;
        background-image: linear-gradient(to right, transparent, #4f46e5, transparent) !important;
    }
</style>
<div class="main-container">
    <h2>Page event detail</h2>

    <section class="event-detail">
        <div class="grid grid-cols-12 gap-10">
            <!-- =============== left =========== -->
            <div class="col-left col-span-8">
                <!-- ===== overview -->
                <div class="main-content rounded-lg" style="background-color: #fff">
                    <!-- img -->
                    <div>
                        <img src="<%=event?.img_banner%>" class="rounded-tl-lg rounded-tr-lg" alt="" />
                    </div>
                    <div class="main-info p-4">
                        <div class="distances">
                            <ul class="distance flex gap-3 mt-2 flex-wrap mt-auto">
                                <li
                                    class="text-[12px] font-medium rounded-sm border border-[#ddd] bg-[rgba(164,174,198,0.2)] p-2 text-center"
                                >
                                    ROAD
                                </li>
                                <li
                                    class="text-[12px] font-medium rounded-sm border border-[#ddd] bg-[rgba(164,174,198,0.2)] p-2 text-center"
                                >
                                    5KM
                                </li>
                                <li
                                    class="text-[12px] font-medium rounded-sm border border-[#ddd] bg-[rgba(164,174,198,0.2)] p-2 text-center"
                                >
                                    10KM
                                </li>
                                <li
                                    class="text-[12px] font-medium rounded-sm border border-[#ddd] bg-[rgba(164,174,198,0.2)] p-2 text-center"
                                >
                                    21KM
                                </li>
                            </ul>
                        </div>
                        <div class="info mt-2 relative">
                            <h2 class="title text-[29px] font-semibold line-clamp-2"><%=event?.name%></h2>
                            <div class="date-time text-[14px] text-[#666] font-medium pt-3">
                                <i class="bi bi-calendar-event mr-1.5"></i> <%=event?.start_date%>
                            </div>
                            <div class="location text-[14px] text-[#666] font-medium">
                                <i class="bi bi-geo-alt mr-1.5"></i> <%=event?.location%>
                            </div>
                            <div
                                class="btn-cta-share text-[14px] bg-[#4f46e5] inline-block absolute bottom-1 right-2 rounded-[20px] text-white px-4 py-3"
                            >
                                <i class="bi bi-share text-[14px]"></i>
                                <span class="text-[14px] space-x-3">Chia sẻ</span>
                            </div>
                        </div>
                        <!--  -->
                        <hr />
                        <div class="organizer">
                            <h3 class="title">Ban tổ chức</h3>
                            <a href="#!">
                                <p>Báo tiền phong</p>
                            </a>
                        </div>
                    </div>
                </div>
                <!-- ===== list section -->
                <!-- Thoong tin sự kiện -->
                <section class="my-card border border-[#ddd] shadow-md rounded-lg px-4 py-3">
                    <div class=" ">
                        <div class="flex justify-between items-center cursor-pointer select-none collapse-header">
                            <h5 class="text-lg font-semibold">⚙️ Solution</h5>
                            <span class="text-gray-500 transition-transform duration-300"
                                ><i class="bi bi-chevron-down"></i
                            ></span>
                        </div>

                        <div class="collapse-body overflow-hidden transition-all duration-300 max-h-0">
                            <div class="pt-4 text-gray-700">Đây là phần nội dung có thể thu gọn hoặc mở rộng.</div>
                        </div>
                    </div>
                </section>
                <!-- Bảng giá vé -->
                <section class="my-card border border-[#ddd] shadow-md rounded-lg px-4 py-3">
                    <div class=" ">
                        <div class="flex justify-between items-center cursor-pointer select-none collapse-header">
                            <h5 class="text-lg font-semibold">⚙️ Solution</h5>
                            <span class="text-gray-500 transition-transform duration-300"
                                ><i class="bi bi-chevron-down"></i
                            ></span>
                        </div>

                        <div class="collapse-body overflow-hidden transition-all duration-300 max-h-0">
                            <div class="pt-4 text-gray-700">Đây là phần nội dung có thể thu gọn hoặc mở rộng.</div>
                        </div>
                    </div>
                </section>
                <!-- Chính sách hủy - chuyển nhượng - Thay đổi thông tin các nhân/cự ly -->
                <section class="my-card border border-[#ddd] shadow-md rounded-lg px-4 py-3">
                    <div class=" ">
                        <div class="flex justify-between items-center cursor-pointer select-none collapse-header">
                            <h5 class="text-lg font-semibold">⚙️ Solution</h5>
                            <span class="text-gray-500 transition-transform duration-300"
                                ><i class="bi bi-chevron-down"></i
                            ></span>
                        </div>

                        <div class="collapse-body overflow-hidden transition-all duration-300 max-h-0">
                            <div class="pt-4 text-gray-700">Đây là phần nội dung có thể thu gọn hoặc mở rộng.</div>
                        </div>
                    </div>
                </section>
                <!-- Lịch trình sự kiện -->
                <section class="my-card border border-[#ddd] shadow-md rounded-lg px-4 py-3">
                    <div class=" ">
                        <div class="flex justify-between items-center cursor-pointer select-none collapse-header">
                            <h5 class="text-lg font-semibold">⚙️ Solution</h5>
                            <span class="text-gray-500 transition-transform duration-300"
                                ><i class="bi bi-chevron-down"></i
                            ></span>
                        </div>

                        <div class="collapse-body overflow-hidden transition-all duration-300 max-h-0">
                            <div class="pt-4 text-gray-700">Đây là phần nội dung có thể thu gọn hoặc mở rộng.</div>
                        </div>
                    </div>
                </section>
                <!-- Racekit -->
                <section class="my-card border border-[#ddd] shadow-md rounded-lg px-4 py-3">
                    <div class=" ">
                        <div class="flex justify-between items-center cursor-pointer select-none collapse-header">
                            <h5 class="text-lg font-semibold">⚙️ Solution</h5>
                            <span class="text-gray-500 transition-transform duration-300"
                                ><i class="bi bi-chevron-down"></i
                            ></span>
                        </div>

                        <div class="collapse-body overflow-hidden transition-all duration-300 max-h-0">
                            <div class="pt-4 text-gray-700">Đây là phần nội dung có thể thu gọn hoặc mở rộng.</div>
                        </div>
                    </div>
                </section>
                <!-- Bản đồ đường chạy -->
                <section class="my-card border border-[#ddd] shadow-md rounded-lg px-4 py-3">
                    <div class=" ">
                        <div class="flex justify-between items-center cursor-pointer select-none collapse-header">
                            <h5 class="text-lg font-semibold">⚙️ Solution</h5>
                            <span class="text-gray-500 transition-transform duration-300"
                                ><i class="bi bi-chevron-down"></i
                            ></span>
                        </div>

                        <div class="collapse-body overflow-hidden transition-all duration-300 max-h-0">
                            <div class="pt-4 text-gray-700">Đây là phần nội dung có thể thu gọn hoặc mở rộng.</div>
                        </div>
                    </div>
                </section>
                <!-- Giải thưởng -->
                <section class="my-card border border-[#ddd] shadow-md rounded-lg px-4 py-3">
                    <div class=" ">
                        <div class="flex justify-between items-center cursor-pointer select-none collapse-header">
                            <h5 class="text-lg font-semibold">⚙️ Solution</h5>
                            <span class="text-gray-500 transition-transform duration-300"
                                ><i class="bi bi-chevron-down"></i
                            ></span>
                        </div>

                        <div class="collapse-body overflow-hidden transition-all duration-300 max-h-0">
                            <div class="pt-4 text-gray-700">Đây là phần nội dung có thể thu gọn hoặc mở rộng.</div>
                        </div>
                    </div>
                </section>
                <!-- Quy định tham dự -->
                <section class="my-card border border-[#ddd] shadow-md rounded-lg px-4 py-3">
                    <div class=" ">
                        <div class="flex justify-between items-center cursor-pointer select-none collapse-header">
                            <h5 class="text-lg font-semibold">⚙️ Solution</h5>
                            <span class="text-gray-500 transition-transform duration-300"
                                ><i class="bi bi-chevron-down"></i
                            ></span>
                        </div>

                        <div class="collapse-body overflow-hidden transition-all duration-300 max-h-0">
                            <div class="pt-4 text-gray-700">Đây là phần nội dung có thể thu gọn hoặc mở rộng.</div>
                        </div>
                    </div>
                </section>
            </div>
            <!-- =============== right===========  -->
            <div class="col-right col-span-4">
                <!-- group links -->
                <div class="my-card p-4 mt-[0_!important] rounded-lg">
                    <div class="group-links flex justify-around flex-wrap gap-4">
                        <a target="_blank" href="<%=event?.organizer_fanpage%>">
                            <div class="anchor flex flex-col justify-center items-center">
                                <div class="icon"><i class="bi bi-facebook text-[32px] text-blue-700"></i></div>
                                <div><span class="text-[14px] font-medium tracking-normal">Fanpage</span></div>
                            </div>
                        </a>
                        <a target="_blank" href="<%=event?.organizer_web%>">
                            <div class="anchor flex flex-col justify-center items-center">
                                <div class="icon"><i class="bi bi-browser-chrome text-[32px]"></i></div>
                                <div><span class="text-[14px] font-medium tracking-normal">Website</span></div>
                            </div>
                        </a>
                        <a target="_blank" href="<%=event?.organizer_zalo%>">
                            <div class="anchor flex flex-col justify-center items-center">
                                <div class="icon">
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        x="0px"
                                        y="0px"
                                        width="48"
                                        height="48"
                                        viewBox="0 0 48 48"
                                    >
                                        <path
                                            fill="#2962ff"
                                            d="M15,36V6.827l-1.211-0.811C8.64,8.083,5,13.112,5,19v10c0,7.732,6.268,14,14,14h10	c4.722,0,8.883-2.348,11.417-5.931V36H15z"
                                        ></path>
                                        <path
                                            fill="#eee"
                                            d="M29,5H19c-1.845,0-3.601,0.366-5.214,1.014C10.453,9.25,8,14.528,8,19	c0,6.771,0.936,10.735,3.712,14.607c0.216,0.301,0.357,0.653,0.376,1.022c0.043,0.835-0.129,2.365-1.634,3.742	c-0.162,0.148-0.059,0.419,0.16,0.428c0.942,0.041,2.843-0.014,4.797-0.877c0.557-0.246,1.191-0.203,1.729,0.083	C20.453,39.764,24.333,40,28,40c4.676,0,9.339-1.04,12.417-2.916C42.038,34.799,43,32.014,43,29V19C43,11.268,36.732,5,29,5z"
                                        ></path>
                                        <path
                                            fill="#2962ff"
                                            d="M36.75,27C34.683,27,33,25.317,33,23.25s1.683-3.75,3.75-3.75s3.75,1.683,3.75,3.75	S38.817,27,36.75,27z M36.75,21c-1.24,0-2.25,1.01-2.25,2.25s1.01,2.25,2.25,2.25S39,24.49,39,23.25S37.99,21,36.75,21z"
                                        ></path>
                                        <path
                                            fill="#2962ff"
                                            d="M31.5,27h-1c-0.276,0-0.5-0.224-0.5-0.5V18h1.5V27z"
                                        ></path>
                                        <path
                                            fill="#2962ff"
                                            d="M27,19.75v0.519c-0.629-0.476-1.403-0.769-2.25-0.769c-2.067,0-3.75,1.683-3.75,3.75	S22.683,27,24.75,27c0.847,0,1.621-0.293,2.25-0.769V26.5c0,0.276,0.224,0.5,0.5,0.5h1v-7.25H27z M24.75,25.5	c-1.24,0-2.25-1.01-2.25-2.25S23.51,21,24.75,21S27,22.01,27,23.25S25.99,25.5,24.75,25.5z"
                                        ></path>
                                        <path
                                            fill="#2962ff"
                                            d="M21.25,18h-8v1.5h5.321L13,26h0.026c-0.163,0.211-0.276,0.463-0.276,0.75V27h7.5	c0.276,0,0.5-0.224,0.5-0.5v-1h-5.321L21,19h-0.026c0.163-0.211,0.276-0.463,0.276-0.75V18z"
                                        ></path>
                                    </svg>
                                </div>
                                <div><span class="text-[14px] font-medium tracking-normal">Nhóm Zalo</span></div>
                            </div>
                        </a>
                    </div>
                </div>

                <!--  -->
                <section id="ticket_type" class="ticket_type mt-6">
                    <div class="max-w-md mx-auto relative overflow-hidden bg-white shadow-xl rounded-xl p-6 space-y-6">
                        <!-- Header -->
                        <!-- lop pattern -->
                        <div class="absolute inset-0 bg-[url('/imgs/map.png')] bg-cover bg-center opacity-20"></div>
                        <!-- lop phu -->
                        <div class="absolute inset-0 bg-white/60 pointer-events-none"></div>
                        <!-- real -->
                        <div class="relative z-10 space-y-6">
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">REGULAR</h2>
                                <p class="text-sm text-gray-500 mt-1">Mở đăng ký: 21/11/2025 - 15/01/2026</p>

                                <div class="flex space-x-2 mt-3">
                                    <div class="h-1 flex-1 bg-blue-600 rounded"></div>
                                    <div class="h-1 flex-1 bg-blue-300 rounded"></div>
                                    <div class="h-1 flex-1 bg-blue-200 rounded"></div>
                                </div>
                            </div>

                            <!-- DISTANCE BLOCK -->
                            <div class="space-y-6">
                                <!--  -->
                                <%if(tickets && tickets.length>0){%> <%tickets.forEach(t=>{%>
                                <div class="flex items-center justify-between border-b pb-4">
                                    <div class="flex items-center space-x-3">
                                        <img src="<%=event.img_thumb%>" class="w-12 h-12 object-cover rounded" />
                                        <span class="font-semibold text-gray-800"><%=t.name%></span>
                                    </div>
                                    <div class="grid grid-cols-1 gap-2 text-center">
                                        <span class="font-semibold text-blue-600"><%=t.price%>,000đ</span>

                                        <!-- Counter -->
                                        <div class="flex items-center space-x-3">
                                            <button
                                                data-id="<%=t._id%>"
                                                class="w-7 h-7 flex items-center justify-center rounded-full border text-gray-500 btn-minus"
                                            >
                                                -
                                            </button>
                                            <span
                                                class="font-semibold inline-block text-center min-w-7"
                                                id="qty-<%=t._id%>"
                                                >0</span
                                            >
                                            <button
                                                data-id="<%=t._id%>"
                                                class="w-7 h-7 flex items-center justify-center rounded-full border text-blue-600 btn-plus"
                                            >
                                                +
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <%})%> <%}%>
                                <!--  -->
                            </div>

                            <!-- Subtotal -->
                            <div class="flex justify-between text-gray-700 font-semibold">
                                <span>Tạm tính:</span>
                                <span id="card_total">0đ</span>
                            </div>

                            <!-- Buttons -->
                            <button id="checkout_shoppingcard"
                                class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700"
                            >
                                ĐĂNG KÝ →
                            </button>

                            <p class="text-xs text-gray-500 text-center">
                                Khi nhấn “ĐĂNG KÝ” đồng nghĩa với việc bạn đã đọc và đồng ý
                                <a href="#" class="underline text-blue-600">Điều khoản</a> &
                                <a href="#" class="underline text-blue-600">Quy định</a> của sự kiện.
                            </p>
                            <!--  -->
                            <a
                                href="/event/group-bib/<%=slug%>"
                                style="width: 100% !important"
                                class="block text-center mb-4 w-full btn-outline-indigo font-semibold px-6 py-2 rounded-lg"
                                >Đăng ký nhóm</a
                            >
                        </div>
                        <!-- <button
                            class="w-full border border-blue-600 text-blue-600 py-3 rounded-lg font-semibold hover:bg-blue-50"
                        >
                            ĐĂNG KÝ NHÓM ↗
                        </button> -->
                    </div>
                </section>
                <!--  -->
                <!-- <div class="my-card p-4 rounded-lg">
                    <h3 class="title text-[20px] font-semibold tracking-normal py-4">Đăng ký nhóm</h3>
                    <p class="text-[14px] my-4 font-light italic text-[#333]">
                        Mở đăng ký: <span class="start_date">07/11/2025</span>-<span class="end_date">04/12/2025</span>
                    </p>
                    <a
                        href="/event/group-bib/<%#=slug%>"
                        style="width: 100% !important"
                        class="block text-center mb-4 w-full btn-outline-indigo font-semibold px-6 py-2 rounded-lg"
                        >Đăng ký nhóm</a
                    >
                </div> -->
                <section id="countdown" class="bg-white rounded-lg text-center p-5 mt-6">
                    <div class="flex justify-center p-5">
                        <div class="flex justify-center flex-nowrap gap-3 text-center lg:justify-start">
                            <div
                                class="w-[50px] h-[50px] bg-[#f5841f] flex justify-center items-center flex-col text-center rounded-[10px] shadow-md p-1"
                            >
                                <p class="px-3 font-bold text-white text-[20px]" id="countdown_date">21</p>
                                <p class="text-[12px] font-medium text-white">Ngày</p>
                            </div>
                            <div
                                class="w-[50px] h-[50px] bg-[#f5841f] flex justify-center items-center flex-col text-center rounded-[10px] shadow-md p-1"
                            >
                                <p class="px-3 font-bold text-white text-[20px]" id="countdown_hour">05</p>
                                <p class="text-[12px] font-medium text-white">Giờ</p>
                            </div>
                            <div
                                class="w-[50px] h-[50px] bg-[#f5841f] flex justify-center items-center flex-col text-center rounded-[10px] shadow-md p-1"
                            >
                                <p class="px-3 font-bold text-white text-[20px]" id="countdown_minute">51</p>
                                <p class="text-[12px] font-medium text-white">Phút</p>
                            </div>
                            <div
                                class="w-[50px] h-[50px] bg-[#f5841f] flex justify-center items-center flex-col text-center rounded-[10px] shadow-md p-1"
                            >
                                <p class="px-3 font-bold text-white text-[20px]" id="countdown_second">30</p>
                                <p class="text-[12px] font-medium text-white">Giây</p>
                            </div>
                        </div>
                    </div>
                    <p>Sự kiện sẽ diễn ra</p>
                </section>
            </div>
        </div>
    </section>

    <!--  -->
</div>
<form id="hiddenCheckoutForm" method="GET" action="/user/event-detail/<%=slug%>/payment">
    <input type="hidden" name="cart" id="cartInput">
</form>
<!-- =============================event # -->

<script>
    // global scope
    localStorage.removeItem('my_ticket')
    const tickets = <%-JSON.stringify(tickets)%>;
    const elementTicketTypeZone = document.querySelector('#ticket_type');
    const btnCtaCheckoutShoppingCard = document.querySelector('#checkout_shoppingcard');
    //
    const ticketsWithQty = tickets.map(item=>({...item, qty: 0}))
    localStorage.setItem('my_ticket', JSON.stringify(ticketsWithQty));
    //
    elementTicketTypeZone.addEventListener('click', function(e){
        // console.log(e.target);
        if(e.target.classList.contains('btn-plus')){
            console.log('add')
            updateQty(e.target.dataset.id, 1);
        };
        if(e.target.classList.contains('btn-minus')){
            console.log('minus')
            updateQty(e.target.dataset.id, -1);
        }
    })
    function updateQty(id, step){
        const myTickets = JSON.parse(localStorage.getItem('my_ticket'));
        const item = myTickets.find((arr)=>arr._id ===id);
        if(!item) return;
        item.qty = (item.qty || 0)+step;
        console.log(item)
        console.log(myTickets)
        if(item.qty<0) item.qty =0;//ko cho am
        localStorage.setItem('my_ticket', JSON.stringify(myTickets));
        document.querySelector('#qty-'+id).innerText = item.qty;
        updateSubTotal();
    }
    function updateSubTotal(){
        const myShoppingCard = JSON.parse(localStorage.getItem('my_ticket'));
        let total = myShoppingCard.reduce((tol, tic)=>tol+tic.price*tic.qty, 0);
        console.log(total);
        // format
        const formatted = (total*1000).toLocaleString('vi-VN')+'đ';
        document.querySelector('#card_total').innerText = formatted;
    }
    //
    btnCtaCheckoutShoppingCard.addEventListener('click', ()=>{
        const myShoppingCard = localStorage.getItem('my_ticket')
        console.log(myShoppingCard);
        document.getElementById('cartInput').value = myShoppingCard;
        document.getElementById('hiddenCheckoutForm').submit();

    })
    document.querySelectorAll('.collapse-header').forEach((header) => {
        header.addEventListener('click', () => {
            const body = header.parentElement.querySelector('.collapse-body');
            const icon = header.querySelector('span');

            if (body.classList.contains('max-h-0')) {
                body.classList.remove('max-h-0');
                body.classList.add('min-h-[100px]'); // đủ cao cho nội dung
                icon.style.transform = 'rotate(180deg)';
            } else {
                body.classList.add('max-h-0');
                body.classList.remove('min-h-[100px]');
                icon.style.transform = 'rotate(0deg)';
            }
        });
    });
</script>
